<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FUALab Frontend</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 2rem;
      background: #f5f5f5;
    }

    .container {
      max-width: 640px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    button {
      background-color: #1f6feb;
      color: #ffffff;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      cursor: pointer;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>

<body>
  <main class="container">
    <h1>FUALab Frontend</h1>
    <p>This static client fetches the health status from the public API.</p>
    <button id="fetchButton">Fetch API Health</button>
    <section>
      <h2>Latest Response</h2>
      <pre id="response">No data loaded yet.</pre>
    </section>
  </main>
  <script>
    const healthButton = document.getElementById("fetchButton");
    const responseBox = document.getElementById("response");

    async function fetchHealth() {
      healthButton.disabled = true;
      responseBox.textContent = "Loading...";
      try {
        const res = await fetch("/api/health");
        if (!res.ok) {
          throw new Error(`Request failed: ${res.status}`);
        }
        const data = await res.json();
        responseBox.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        responseBox.textContent = `Error: ${err instanceof Error ? err.message : String(err)}`;
      } finally {
        healthButton.disabled = false;
      }
    }

    document.body.insertAdjacentHTML(
      "beforeend",
      `
    <main class="container" style="margin-top:2rem">
      <h1>Items</h1>
      <form id="itemForm">
        <input id="itemName" placeholder="Item name" required style="padding:0.5rem; width:60%" />
        <button type="submit">Create</button>
      </form>
      <pre id="itemsBox">No items loaded yet.</pre>
    </main>
    `
    );

    const itemForm = document.getElementById("itemForm");
    const itemName = document.getElementById("itemName");
    const itemsBox = document.getElementById("itemsBox");

    async function loadItems() {
      try {
        const res = await fetch("/api/items");
        if (!res.ok) {
          throw new Error(`Request failed: ${res.status}`);
        }
        const data = await res.json();
        itemsBox.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        itemsBox.textContent = `Error: ${err instanceof Error ? err.message : String(err)}`;
      }
    }

    itemForm.addEventListener("submit", async (event) => {
      event.preventDefault();
      try {
        const res = await fetch("/api/items", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: itemName.value })
        });
        if (!res.ok) {
          const payload = await res.text();
          throw new Error(`Request failed: ${res.status} ${payload}`);
        }
        itemName.value = "";
        await loadItems();
      } catch (err) {
        itemsBox.textContent = `Error: ${err instanceof Error ? err.message : String(err)}`;
      }
    });

    loadItems();
    healthButton.addEventListener("click", fetchHealth);
  </script>
</body>

</html>